<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
  <head>
    <title>NagVis Automap</title>
        <link rel="stylesheet" type="text/css" media="screen" href="../general/css/style.css" />
  </head>
    <body>
        <h1>NagVis Automap</h1>
        <h2> Introduction </h2>
        The NagVis Automap was introduced in NagVis 1.3. The main topic of this feature is to replace the builtin map in Nagios. The main problem of the Nagios map is that it is not scalable. In big Nagios installations the automap is not usable. This is e.g. caused by missing configuration options like selecting a defined scope of elements to display.
        
        NagVis handles the objects and defines a configuration for <a href="http://www.graphviz.org" target="_blank">Graphviz</a>. The map image and the HTML-Code for the links are generated by graphviz and passed on to NagVis.
        
        <h2>Prerequisites</h2>
        <ul>
        <li> <a href="http://www.graphviz.org" target="_blank">Graphviz</a> >= 2.14 for the automap (lower versions have problems with truecolor rendering). You also need more packages like gd,libpng,freetype, ... but if you get graphviz compiled/installed it should work.</li>
        <li> You have to define dependencies between hosts starting with the Nagios server. Please have a look at the <a href="http://nagios.sourceforge.net/docs/3_0/networkreachability.html">Nagios documentation</a> on how to do this</li> 
        </ul>
        
        <h2> First call </h2>
        If you have no experience with the automap yet, take a look at the demo automaps installed with NagVis (demo-automap and demo-automap2). You should be able to
        open those automaps right after installation of NagVis from the "Open" menu in header navigation.

        If everything is configured properly the root host and three levels of child hosts should be displayed on the demonstration automap "demo-automap".
        
        <h2> Map configuration </h2>
        In the past, the automaps were configured in special configuration files located in <code>etc/automaps</code>, but this has changed with NagVis 1.7.
        The automap configuration files are created as regular map configurations (like described in 
        <a href="map_config_format_description">map configuration</a>). To create an
        automap in NagVis 1.7 you have to set the map source to <code>automap</code>. To do this, you need to add the <code>sources</code> parameter
        to the global section and set its value to <code>automap</code>.
        
        <h2> Main configuration </h2>
        Some parameters for the automap can be set in the main configuration of NagVis. For further information see <a href="nagvis_config_format_description.html">Main Configuration</a>.
        
        <h2> URL Parameters </h2>
        The automap can be called with several url parameters. Since NagVis 1.7 these options can be put into the
        global section of the map configuration to persist those parameters. Here is a list of the automap options:
        <table style="width:100%">
        <tr>
            <th>Parameter</th><th>Default</th><th>Description</th>
        </tr>
        <tr>
            <td>show</td><td></td><td>The name of the automap. Since NagVis 1.5 different automap configuration files can be defined. The automap to view needs to be set here.</td>
        </tr>
        <tr>
            <td>backend_id <strike>backend</strike></td><td> default backend </td><td> The backend-id of the backend to fetch the objects from. For details see the [backend_*] section in the <a href="nagvis_config_format_description.html">Main Configuration</a> </td>
        </tr>
        <tr>
            <td>root</td><td> see <a href="#root/object/definition">root object definition</a> </td><td> This is the name of the root object. It is not essential to set the host here. There are some more ways to tell the root object. For details see the <a href="#root/object/definition">root object definition</a> chapter on this page. </td>
        </tr>
        <tr>
            <td>child_layers <strike>childLayers</strike></td><td>2</td><td>Maximum layers of child hosts to be displayed.</td>
        </tr>
        <tr>
            <td>parent_layers <strike>parentLayers</strike></td><td>0</td><td>Maximum layers of parent hosts to be displayed.</td>
        </tr>
        <tr>
            <td>render_mode <strike>renderMode</strike></td><td> undirected </td><td> Set the render mode of the map. For details see <a href="#available/render/modes">available render modes</a> </td>
        </tr>
        <tr>
            <td>width</td><td> 1024 </td><td> width of the automap in pixels </td>
        </tr>
        <tr>
            <td>height</td><td> 786 </td><td> height of the automap in pixels </td>
        </tr>
        <tr>
            <td>ignore_hosts <strike>ignoreHosts</strike></td><td> none </td><td> comma separated list of hosts (including children) not to display </td>
        </tr>
        <tr>
            <td>filter_by_state <strike>filterByState</strike></td><td>none</td><td>Set to 1 to enable the &quot;problem automap&quot; mode. When it is set to 1 it will exclude all branches which have only OK/UP hosts. This will result in a "problem automap" which only shows up a tree where each branch has at least one problem.</td>
        </tr>
        <tr>
            <td>filter_by_id</td><td></td><td>Exclude specified object_ids, is mostly used internal <font color="#ff0000">(new in 1.7)</font></td>
        <tr>
            <td>filter_group <strike>filterGroup</strike></td><td>none</td><td>Provide a hostgroup name. Only hosts in this hostgroup will be shown on the map.</td>
        </tr>
        <tr>
            <td>search</td><td>none</td><td>Search for a map object on map load. Matching objects will be highlighted.</td>
        </tr>
        <tr>
            <td>rankdir</td><td>LR</td><td>Configure direction of directed automaps, can be set to TB (Top/Bottom) and LR (Left/Right) <font color="#ff0000">(new in 1.7)</font></td>
        </tr>
        <tr>
            <td>rotation</td><td>none</td><td>Rotate in the given rotation pool when the map is a step in the pool.</td>
        </tr>
        <tr>
            <td>header_menu <strike>enableHeader</strike></td><td>none</td><td>Enable/Disable the header menu. To be specified as integer (1/0). Overrides the configuration.</td>
        </tr>
        <tr>
            <td>hover_menu <strike>enableHover</strike></td><td>none</td><td>Enable/Disable the hover menus. To be specified as integer (1/0). Overrides the configuration.</td>
        </tr>
        <tr>
            <td>context_menu <strike>enableContext</strike></td><td>none</td><td>Enable/Disable the context menus. To be specified as integer (1/0). Overrides the configuration.</td>
        </tr>
        <tr>
            <td>margin</td><td>50</td><td>Sets the free area on the border of the automap graph. Has to be specified in pixels.</td>
        </tr>
        <tr>
            <td>overlap</td><td>true</td><td>Configure collision handling of objects (take a look at the graphviz docs for explanations of the values) <font color="#ff0000">(new in 1.7)</font></td>
        </tr>
        </table>
        
        <a name=root/object/definition></a>
        <h2> Root object definition </h2>
        The approach of the automap is to start at one root object and go down the dependency-tree like defined in Nagios and show all these objects on the map.
        
        There are several ways to get the root object:
        <ul>
        <li> URL-Parameter: The root object can be set by the parameter <code>root</code>.</li>
        <li> Main configuration: The <code>defaultroot</code> option can be set in the <code>[automap]</code> section.</li>
        <li> Auto detection: Ask the backend for a host without parent. This only works when there is ONE host in your Nagios installation without any parent object.</li>
        </ul>
        
        The list above is ordered by priority.
        
        <a name=available/render/modes></a>
        <h2> Available render modes </h2>
        There are several render modes available:
        
        <table>
        <tr>
        <th> Mode </th><th style="width:200px"> Example image </th>
        </tr>
        <tr>
        <td valign="top"> directed </td>
        <td align="center"><img alt="" src="../general/img/nagvis-1.3-automap-directed-1-thumb.png" /></td>
        </tr>
        <tr>
        <td valign="top"> undirected </td>
        <td align="center"><img alt="" src="../general/img/nagvis-1.3-automap_undirected-1-thumb.png" /></td>
        </tr>
        <tr>
        <td valign="top"> radial </td>
        <td> </td>
        </tr>
        <tr>
        <td valign="top"> circular </td>
        <td> </td>
        </tr>
        <tr>
        <td valign="top"> undirected2 </td>
        <td> </td>
        </tr>
        </table>

        <h2>Automap to Map export</h2>
        <p>Since NagVis 1.5 it is possible to export the current automap view as a
    classic NagVis map. Exporting automaps to classic maps you get the advantages
        of both worlds.</p>
        <p>You can start with the automap to get all the object positioned on your maps
        using the automap render modes. Once you finished the rendering you can export
        the automap including the generated background image to a regular map using the
        &quot;Export to map&quot; which can be found in the &quot;Actions&quot; submenu
        in your header menu.</p>
        <p>Using the exported map you can add design elements as you like and customize
        your layout according to your needs.</p>
        <p>A map can be exported multiple times to the same target map but it will
        overwrite all changes you made to the target map before. You can only overwrite
        maps you have edit permissions on.</p>
        <p>A classic map can not be turned into an automap.</p>

        <h2>Host URLs</h2>
        <p>The URLs of the host objects are used for identifying the host objects during
        automap rendering. Especially the &quot;host=&quot; parameter is important. When
        this parameter is missing in the host URLs the object positions can not be gathered.</p>
        <p>By default this information should not be of interest to you. But when you customize the
        host URLs in your NagVis installation it is important to know that your custom URL
        needs to have the &quot;host=&quot; parameter set to the hostname of the object to
        be able to use the hosts on the automap.</p>
    </body>
</html>
